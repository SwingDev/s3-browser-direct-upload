var _, assert, chai, expect, fs, moment, path, s3BrowserUpload, sinon, sinonChai;

_ = require('lodash');

fs = require('fs');

moment = require('moment');

chai = require('chai');

path = require('path');

sinon = require('sinon');

sinonChai = require('sinon-chai');

assert = chai.assert;

expect = chai.expect;

chai.use(sinonChai);

s3BrowserUpload = require('../lib');

describe('s3-uploadPostForm tests', function() {
  var runTests;
  runTests = function(asEnvironmentVar) {
    var accessKeyId, secretAccessKey, testNameSuffix;
    delete process.env.AWS_ACCESS_KEY_ID;
    delete process.env.AWS_SECRET_ACCESS_KEY;
    accessKeyId = 'rHiziprP5FLOL5DpLaRc';
    secretAccessKey = 'dGudXJxDvtgZ2oRvzuMY1uWA/tsziUXwkd3tnJBk';
    testNameSuffix = ' without env';
    if (asEnvironmentVar) {
      process.env.AWS_ACCESS_KEY_ID = accessKeyId;
      process.env.AWS_SECRET_ACCESS_KEY = secretAccessKey;
      accessKeyId = '';
      secretAccessKey = '';
      testNameSuffix = ' with env';
    }
    describe('#uploadPostForm tests' + testNameSuffix, function() {
      var s3client;
      s3client = null;
      before(function() {
        console.log(accessKeyId);
        return s3client = new s3BrowserUpload({
          accessKeyId: accessKeyId,
          secretAccessKey: secretAccessKey,
          signatureVersion: "v4",
          region: "eu-central-1"
        });
      });
      it('should return json with all parameters required to build a form', function(done) {
        var uploadPostFormOptions;
        uploadPostFormOptions = {
          key: "testKey.jpg",
          bucket: 'testBucket',
          expires: moment().add(60, 'minutes').toDate(),
          extension: 'jpg'
        };
        return s3client.uploadPostForm(uploadPostFormOptions, function(err, params) {
          expect(params).to.have.deep.property('params.key');
          expect(params).to.have.deep.property('params.acl');
          expect(params).to.have.deep.property('params.content-type');
          expect(params).to.have.deep.property('params.x-amz-algorithm');
          expect(params).to.have.deep.property('params.x-amz-credential');
          expect(params).to.have.deep.property('params.x-amz-date');
          expect(params).to.have.deep.property('params.policy');
          expect(params).to.have.deep.property('params.x-amz-signature');
          expect(params).to.have.deep.property('public_url');
          expect(params).to.have.deep.property('form_url');
          expect(params).to.not.have.deep.property('conditions');
          return done();
        });
      });
      return it('should return json with all parameters required to build a form if custom conditionMatching used', function(done) {
        var uploadPostFormOptions;
        uploadPostFormOptions = {
          key: "testKey.jpg",
          bucket: 'testBucket',
          expires: moment().add(60, 'minutes').toDate(),
          extension: 'jpg',
          conditionMatching: [
            {
              "success_action_redirect": "http://google.com"
            }
          ]
        };
        return s3client.uploadPostForm(uploadPostFormOptions, function(err, params) {
          expect(params).to.have.deep.property('params.key');
          expect(params).to.have.deep.property('params.acl');
          expect(params).to.have.deep.property('params.content-type');
          expect(params).to.have.deep.property('params.x-amz-algorithm');
          expect(params).to.have.deep.property('params.x-amz-credential');
          expect(params).to.have.deep.property('params.x-amz-date');
          expect(params).to.have.deep.property('params.policy');
          expect(params).to.have.deep.property('params.x-amz-signature');
          expect(params).to.have.deep.property('public_url');
          expect(params).to.have.deep.property('form_url');
          expect(params).to.have.deep.property('conditions');
          return done();
        });
      });
    });
    describe('#upload tests' + testNameSuffix, function() {
      var s3client;
      s3client = null;
      before(function() {
        s3client = new s3BrowserUpload({
          accessKeyId: accessKeyId,
          secretAccessKey: secretAccessKey,
          signatureVersion: "v4",
          region: "eu-central-1"
        });
        return sinon.stub(s3client.s3, 'upload', function(params, cb) {
          return cb();
        });
      });
      after(function() {
        return s3client.s3.upload.restore();
      });
      return it('should return url of uploaded file', function(done) {
        var uploadOptions;
        uploadOptions = {
          data: "String Object data",
          key: "testKey.txt",
          bucket: 'testBucket',
          extension: 'txt',
          acl: 'public-read'
        };
        return s3client.upload(uploadOptions, function(err, url) {
          expect(url).to.exists;
          expect(url).to.equal('https://testBucket.s3.amazonaws.com/testKey.txt');
          return done();
        });
      });
    });
    return describe('#put tests' + testNameSuffix, function() {
      var s3client;
      s3client = null;
      before(function() {
        s3client = new s3BrowserUpload({
          accessKeyId: accessKeyId,
          secretAccessKey: secretAccessKey,
          signatureVersion: "v4",
          region: "eu-central-1"
        });
        return sinon.stub(s3client.s3, 'getSignedUrl', function(typeName, params, cb) {
          return cb(null, 'https://testBucket.s3.amazonaws.com/testKey.txt');
        });
      });
      after(function() {
        return s3client.s3.getSignedUrl.restore();
      });
      return it('should return json with signed and public urls', function(done) {
        var uploadOptions;
        uploadOptions = {
          key: "testKey.txt",
          bucket: 'testBucket',
          extension: 'txt',
          acl: 'public-read'
        };
        return s3client.put(uploadOptions, function(err, urls) {
          expect(urls).to.have.property('signed_url');
          expect(urls).to.have.property('public_url');
          return done();
        });
      });
    });
  };
  runTests(true);
  return runTests(false);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC9pbmRleC5qcyIsInNvdXJjZXMiOlsidGVzdC9pbmRleC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBQTs7QUFBQSxDQUFBLEdBQWMsT0FBQSxDQUFRLFFBQVI7O0FBQ2QsRUFBQSxHQUFjLE9BQUEsQ0FBUSxJQUFSOztBQUNkLE1BQUEsR0FBYyxPQUFBLENBQVEsUUFBUjs7QUFFZCxJQUFBLEdBQWMsT0FBQSxDQUFRLE1BQVI7O0FBQ2QsSUFBQSxHQUFjLE9BQUEsQ0FBUSxNQUFSOztBQUNkLEtBQUEsR0FBYyxPQUFBLENBQVEsT0FBUjs7QUFDZCxTQUFBLEdBQWMsT0FBQSxDQUFRLFlBQVI7O0FBRWQsTUFBQSxHQUFZLElBQUksQ0FBQzs7QUFDakIsTUFBQSxHQUFZLElBQUksQ0FBQzs7QUFFakIsSUFBSSxDQUFDLEdBQUwsQ0FBUyxTQUFUOztBQUNBLGVBQUEsR0FBa0IsT0FBQSxDQUFRLFFBQVI7O0FBSWxCLFFBQUEsQ0FBUyx5QkFBVCxFQUFvQyxTQUFBO0FBQ2xDLE1BQUE7RUFBQSxRQUFBLEdBQVcsU0FBQyxnQkFBRDtBQUNULFFBQUE7SUFBQSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUM7SUFDbkIsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDO0lBQ25CLFdBQUEsR0FBYztJQUNkLGVBQUEsR0FBa0I7SUFDbEIsY0FBQSxHQUFpQjtJQUVqQixJQUFHLGdCQUFIO01BQ0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBWixHQUFnQztNQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFaLEdBQW9DO01BQ3BDLFdBQUEsR0FBYztNQUNkLGVBQUEsR0FBa0I7TUFDbEIsY0FBQSxHQUFpQixZQUxuQjs7SUFPQSxRQUFBLENBQVMsdUJBQUEsR0FBMEIsY0FBbkMsRUFBb0QsU0FBQTtBQUVsRCxVQUFBO01BQUEsUUFBQSxHQUFXO01BRVgsTUFBQSxDQUFPLFNBQUE7UUFDTCxPQUFPLENBQUMsR0FBUixDQUFZLFdBQVo7ZUFDQSxR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QixFQUF3QyxTQUFDLFFBQUQsRUFBVyxNQUFYLEVBQW1CLEVBQW5CO2lCQUN0QyxFQUFBLENBQUcsSUFBSCxFQUFTLGlEQUFUO1FBRHNDLENBQXhDO01BUEssQ0FBUDtNQVVBLEtBQUEsQ0FBTSxTQUFBO2VBQ0osUUFBUSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBekIsQ0FBQTtNQURJLENBQU47YUFHQSxFQUFBLENBQUcsZ0RBQUgsRUFBcUQsU0FBQyxJQUFEO0FBQ25ELFlBQUE7UUFBQSxhQUFBLEdBQ0U7VUFBQSxHQUFBLEVBQUssYUFBTDtVQUNBLE1BQUEsRUFBUSxZQURSO1VBRUEsU0FBQSxFQUFXLEtBRlg7VUFHQSxHQUFBLEVBQUssYUFITDs7ZUFLRixRQUFRLENBQUMsR0FBVCxDQUFhLGFBQWIsRUFBNEIsU0FBQyxHQUFELEVBQU0sSUFBTjtVQUMxQixNQUFBLENBQU8sSUFBUCxDQUFZLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFyQixDQUE4QixZQUE5QjtVQUNBLE1BQUEsQ0FBTyxJQUFQLENBQVksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQXJCLENBQThCLFlBQTlCO2lCQUNBLElBQUEsQ0FBQTtRQUgwQixDQUE1QjtNQVBtRCxDQUFyRDtJQWpCc0MsQ0FBeEM7RUF2R1M7RUFvSVgsUUFBQSxDQUFTLElBQVQ7U0FDQSxRQUFBLENBQVMsS0FBVDtBQXRJa0MsQ0FBcEMiLCJzb3VyY2VzQ29udGVudCI6WyIjIHMzLWJyb3dzZXItZGlyZWN0LXVwbG9hZFxuXyAgICAgICAgICAgPSByZXF1aXJlKCdsb2Rhc2gnKVxuZnMgICAgICAgICAgPSByZXF1aXJlKCdmcycpXG5tb21lbnQgICAgICA9IHJlcXVpcmUoJ21vbWVudCcpXG5cbmNoYWkgICAgICAgID0gcmVxdWlyZSgnY2hhaScpXG5wYXRoICAgICAgICA9IHJlcXVpcmUoJ3BhdGgnKVxuc2lub24gICAgICAgPSByZXF1aXJlKCdzaW5vbicpXG5zaW5vbkNoYWkgICA9IHJlcXVpcmUoJ3Npbm9uLWNoYWknKVxuXG5hc3NlcnQgICAgPSBjaGFpLmFzc2VydFxuZXhwZWN0ICAgID0gY2hhaS5leHBlY3RcblxuY2hhaS51c2Uoc2lub25DaGFpKVxuczNCcm93c2VyVXBsb2FkID0gcmVxdWlyZSgnLi4vbGliJylcblxuXG4jIFRFU1RTXG5kZXNjcmliZSAnczMtdXBsb2FkUG9zdEZvcm0gdGVzdHMnLCAoKSAtPlxuICBydW5UZXN0cyA9IChhc0Vudmlyb25tZW50VmFyKSAtPlxuICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRFxuICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0FDQ0VTU19LRVlcbiAgICBhY2Nlc3NLZXlJZCA9ICdySGl6aXByUDVGTE9MNURwTGFSYydcbiAgICBzZWNyZXRBY2Nlc3NLZXkgPSAnZEd1ZFhKeER2dGdaMm9Sdnp1TVkxdVdBL3RzemlVWHdrZDN0bkpCaydcbiAgICB0ZXN0TmFtZVN1ZmZpeCA9ICcgd2l0aG91dCBlbnYnXG5cbiAgICBpZiBhc0Vudmlyb25tZW50VmFyXG4gICAgICBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCA9IGFjY2Vzc0tleUlkXG4gICAgICBwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0FDQ0VTU19LRVkgPSBzZWNyZXRBY2Nlc3NLZXlcbiAgICAgIGFjY2Vzc0tleUlkID0gJydcbiAgICAgIHNlY3JldEFjY2Vzc0tleSA9ICcnXG4gICAgICB0ZXN0TmFtZVN1ZmZpeCA9ICcgd2l0aCBlbnYnXG5cbiAgICBkZXNjcmliZSAnI3VwbG9hZFBvc3RGb3JtIHRlc3RzJyArIHRlc3ROYW1lU3VmZml4ICwgKCkgLT5cblxuICAgICAgczNjbGllbnQgPSBudWxsXG5cbiAgICAgIGJlZm9yZSAtPlxuICAgICAgICBjb25zb2xlLmxvZyBhY2Nlc3NLZXlJZFxuICAgICAgICBzM2NsaWVudCA9IG5ldyBzM0Jyb3dzZXJVcGxvYWRcbiAgICAgICAgICBhY2Nlc3NLZXlJZDogYWNjZXNzS2V5SWRcbiAgICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6IHNlY3JldEFjY2Vzc0tleVxuICAgICAgICAgIHNpZ25hdHVyZVZlcnNpb246IFwidjRcIlxuICAgICAgICAgIHJlZ2lvbjogXCJldS1jZW50cmFsLTFcIlxuXG4gICAgICBpdCAnc2hvdWxkIHJldHVybiBqc29uIHdpdGggYWxsIHBhcmFtZXRlcnMgcmVxdWlyZWQgdG8gYnVpbGQgYSBmb3JtJywgKGRvbmUpIC0+XG4gICAgICAgIHVwbG9hZFBvc3RGb3JtT3B0aW9ucyA9XG4gICAgICAgICAga2V5OiBcInRlc3RLZXkuanBnXCJcbiAgICAgICAgICBidWNrZXQ6ICd0ZXN0QnVja2V0J1xuICAgICAgICAgIGV4cGlyZXM6IG1vbWVudCgpLmFkZCg2MCwgJ21pbnV0ZXMnKS50b0RhdGUoKVxuICAgICAgICAgIGV4dGVuc2lvbjogJ2pwZydcblxuICAgICAgICBzM2NsaWVudC51cGxvYWRQb3N0Rm9ybSB1cGxvYWRQb3N0Rm9ybU9wdGlvbnMsIChlcnIsIHBhcmFtcykgLT5cbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy5rZXknXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMuYWNsJ1xuICAgICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLmNvbnRlbnQtdHlwZSdcbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1hbGdvcml0aG0nXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMueC1hbXotY3JlZGVudGlhbCdcbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1kYXRlJ1xuICAgICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLnBvbGljeSdcbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1zaWduYXR1cmUnXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwdWJsaWNfdXJsJ1xuICAgICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAnZm9ybV91cmwnXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8ubm90LmhhdmUuZGVlcC5wcm9wZXJ0eSAnY29uZGl0aW9ucydcblxuICAgICAgICAgIGRvbmUoKVxuXG4gICAgICBpdCAnc2hvdWxkIHJldHVybiBqc29uIHdpdGggYWxsIHBhcmFtZXRlcnMgcmVxdWlyZWQgdG8gYnVpbGQgYSBmb3JtIGlmIGN1c3RvbSBjb25kaXRpb25NYXRjaGluZyB1c2VkJywgKGRvbmUpIC0+XG4gICAgICAgIHVwbG9hZFBvc3RGb3JtT3B0aW9ucyA9XG4gICAgICAgICAga2V5OiBcInRlc3RLZXkuanBnXCJcbiAgICAgICAgICBidWNrZXQ6ICd0ZXN0QnVja2V0J1xuICAgICAgICAgIGV4cGlyZXM6IG1vbWVudCgpLmFkZCg2MCwgJ21pbnV0ZXMnKS50b0RhdGUoKVxuICAgICAgICAgIGV4dGVuc2lvbjogJ2pwZydcbiAgICAgICAgICBjb25kaXRpb25NYXRjaGluZzogW1xuICAgICAgICAgICAge1wic3VjY2Vzc19hY3Rpb25fcmVkaXJlY3RcIjogXCJodHRwOi8vZ29vZ2xlLmNvbVwifVxuICAgICAgICAgIF1cblxuICAgICAgICBzM2NsaWVudC51cGxvYWRQb3N0Rm9ybSB1cGxvYWRQb3N0Rm9ybU9wdGlvbnMsIChlcnIsIHBhcmFtcykgLT5cbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy5rZXknXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMuYWNsJ1xuICAgICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLmNvbnRlbnQtdHlwZSdcbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1hbGdvcml0aG0nXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMueC1hbXotY3JlZGVudGlhbCdcbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1kYXRlJ1xuICAgICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLnBvbGljeSdcbiAgICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1zaWduYXR1cmUnXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwdWJsaWNfdXJsJ1xuICAgICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAnZm9ybV91cmwnXG4gICAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdjb25kaXRpb25zJ1xuXG4gICAgICAgICAgZG9uZSgpXG5cbiAgICBkZXNjcmliZSAnI3VwbG9hZCB0ZXN0cycgKyB0ZXN0TmFtZVN1ZmZpeCwgKCkgLT5cblxuICAgICAgczNjbGllbnQgPSBudWxsXG5cbiAgICAgIGJlZm9yZSAtPlxuICAgICAgICBzM2NsaWVudCA9IG5ldyBzM0Jyb3dzZXJVcGxvYWRcbiAgICAgICAgICBhY2Nlc3NLZXlJZDogYWNjZXNzS2V5SWRcbiAgICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6IHNlY3JldEFjY2Vzc0tleVxuICAgICAgICAgIHNpZ25hdHVyZVZlcnNpb246IFwidjRcIlxuICAgICAgICAgIHJlZ2lvbjogXCJldS1jZW50cmFsLTFcIlxuXG4gICAgICAgIHNpbm9uLnN0dWIgczNjbGllbnQuczMsICd1cGxvYWQnLCAocGFyYW1zLCBjYikgLT5cbiAgICAgICAgICBjYigpXG5cbiAgICAgIGFmdGVyIC0+XG4gICAgICAgIHMzY2xpZW50LnMzLnVwbG9hZC5yZXN0b3JlKClcblxuICAgICAgaXQgJ3Nob3VsZCByZXR1cm4gdXJsIG9mIHVwbG9hZGVkIGZpbGUnLCAoZG9uZSkgLT5cbiAgICAgICAgdXBsb2FkT3B0aW9ucyA9XG4gICAgICAgICAgZGF0YTogXCJTdHJpbmcgT2JqZWN0IGRhdGFcIlxuICAgICAgICAgIGtleTogXCJ0ZXN0S2V5LnR4dFwiXG4gICAgICAgICAgYnVja2V0OiAndGVzdEJ1Y2tldCdcbiAgICAgICAgICBleHRlbnNpb246ICd0eHQnXG4gICAgICAgICAgYWNsOiAncHVibGljLXJlYWQnXG5cbiAgICAgICAgczNjbGllbnQudXBsb2FkIHVwbG9hZE9wdGlvbnMsIChlcnIsIHVybCkgLT5cbiAgICAgICAgICBleHBlY3QodXJsKS50by5leGlzdHNcbiAgICAgICAgICBleHBlY3QodXJsKS50by5lcXVhbCAnaHR0cHM6Ly90ZXN0QnVja2V0LnMzLmFtYXpvbmF3cy5jb20vdGVzdEtleS50eHQnXG4gICAgICAgICAgZG9uZSgpXG5cbiAgICBkZXNjcmliZSAnI3B1dCB0ZXN0cycgKyB0ZXN0TmFtZVN1ZmZpeCwgKCkgLT5cblxuICAgICAgczNjbGllbnQgPSBudWxsXG5cbiAgICAgIGJlZm9yZSAtPlxuICAgICAgICBzM2NsaWVudCA9IG5ldyBzM0Jyb3dzZXJVcGxvYWRcbiAgICAgICAgICBhY2Nlc3NLZXlJZDogYWNjZXNzS2V5SWRcbiAgICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6IHNlY3JldEFjY2Vzc0tleVxuICAgICAgICAgIHNpZ25hdHVyZVZlcnNpb246IFwidjRcIlxuICAgICAgICAgIHJlZ2lvbjogXCJldS1jZW50cmFsLTFcIlxuXG4gICAgICAgIHNpbm9uLnN0dWIgczNjbGllbnQuczMsICdnZXRTaWduZWRVcmwnLCAodHlwZU5hbWUsIHBhcmFtcywgY2IpIC0+XG4gICAgICAgICAgY2IobnVsbCwgJ2h0dHBzOi8vdGVzdEJ1Y2tldC5zMy5hbWF6b25hd3MuY29tL3Rlc3RLZXkudHh0JylcblxuICAgICAgYWZ0ZXIgLT5cbiAgICAgICAgczNjbGllbnQuczMuZ2V0U2lnbmVkVXJsLnJlc3RvcmUoKVxuXG4gICAgICBpdCAnc2hvdWxkIHJldHVybiBqc29uIHdpdGggc2lnbmVkIGFuZCBwdWJsaWMgdXJscycsIChkb25lKSAtPlxuICAgICAgICB1cGxvYWRPcHRpb25zID1cbiAgICAgICAgICBrZXk6IFwidGVzdEtleS50eHRcIlxuICAgICAgICAgIGJ1Y2tldDogJ3Rlc3RCdWNrZXQnXG4gICAgICAgICAgZXh0ZW5zaW9uOiAndHh0J1xuICAgICAgICAgIGFjbDogJ3B1YmxpYy1yZWFkJ1xuXG4gICAgICAgIHMzY2xpZW50LnB1dCB1cGxvYWRPcHRpb25zLCAoZXJyLCB1cmxzKSAtPlxuICAgICAgICAgIGV4cGVjdCh1cmxzKS50by5oYXZlLnByb3BlcnR5ICdzaWduZWRfdXJsJ1xuICAgICAgICAgIGV4cGVjdCh1cmxzKS50by5oYXZlLnByb3BlcnR5ICdwdWJsaWNfdXJsJ1xuICAgICAgICAgIGRvbmUoKVxuXG4gIHJ1blRlc3RzIHRydWVcbiAgcnVuVGVzdHMgZmFsc2VcblxuXG5cbiJdfQ==
