var _, assert, chai, expect, fs, moment, path, s3BrowserUpload, sinon, sinonChai;

_ = require('lodash');

fs = require('fs');

moment = require('moment');

chai = require('chai');

path = require('path');

sinon = require('sinon');

sinonChai = require('sinon-chai');

assert = chai.assert;

expect = chai.expect;

chai.use(sinonChai);

s3BrowserUpload = require('../lib');

describe('s3-uploadPostForm tests', function() {
  describe('#uploadPostForm tests', function() {
    var s3client;
    s3client = null;
    before(function() {
      return s3client = new s3BrowserUpload({
        accessKeyId: 'rHiziprP5FLOL5DpLaRc',
        secretAccessKey: 'dGudXJxDvtgZ2oRvzuMY1uWA/tsziUXwkd3tnJBk',
        signatureVersion: "v4",
        region: "eu-central-1"
      });
    });
    it('should return json with all parameters required to build a form', function(done) {
      var uploadPostFormOptions;
      uploadPostFormOptions = {
        key: "testKey.jpg",
        bucket: 'testBucket',
        expires: moment().add(60, 'minutes').toDate(),
        extension: 'jpg'
      };
      return s3client.uploadPostForm(uploadPostFormOptions, function(err, params) {
        expect(params).to.have.deep.property('params.key');
        expect(params).to.have.deep.property('params.acl');
        expect(params).to.have.deep.property('params.content-type');
        expect(params).to.have.deep.property('params.x-amz-algorithm');
        expect(params).to.have.deep.property('params.x-amz-credential');
        expect(params).to.have.deep.property('params.x-amz-date');
        expect(params).to.have.deep.property('params.policy');
        expect(params).to.have.deep.property('params.x-amz-signature');
        expect(params).to.have.deep.property('public_url');
        expect(params).to.have.deep.property('form_url');
        expect(params).to.not.have.deep.property('conditions');
        return done();
      });
    });
    return it('should return json with all parameters required to build a form if custom conditionMatching used', function(done) {
      var uploadPostFormOptions;
      uploadPostFormOptions = {
        key: "testKey.jpg",
        bucket: 'testBucket',
        expires: moment().add(60, 'minutes').toDate(),
        extension: 'jpg',
        conditionMatching: [
          {
            "success_action_redirect": "http://google.com"
          }
        ]
      };
      return s3client.uploadPostForm(uploadPostFormOptions, function(err, params) {
        expect(params).to.have.deep.property('params.key');
        expect(params).to.have.deep.property('params.acl');
        expect(params).to.have.deep.property('params.content-type');
        expect(params).to.have.deep.property('params.x-amz-algorithm');
        expect(params).to.have.deep.property('params.x-amz-credential');
        expect(params).to.have.deep.property('params.x-amz-date');
        expect(params).to.have.deep.property('params.policy');
        expect(params).to.have.deep.property('params.x-amz-signature');
        expect(params).to.have.deep.property('public_url');
        expect(params).to.have.deep.property('form_url');
        expect(params).to.have.deep.property('conditions');
        return done();
      });
    });
  });
  describe('#upload tests', function() {
    var s3client;
    s3client = null;
    before(function() {
      s3client = new s3BrowserUpload({
        accessKeyId: 'rHiziprP5FLOL5DpLaRc',
        secretAccessKey: 'dGudXJxDvtgZ2oRvzuMY1uWA/tsziUXwkd3tnJBk',
        signatureVersion: "v4",
        region: "eu-central-1"
      });
      return sinon.stub(s3client.s3, 'upload', function(params, cb) {
        return cb();
      });
    });
    after(function() {
      return s3client.s3.upload.restore();
    });
    return it('should return url of uploaded file', function(done) {
      var uploadOptions;
      uploadOptions = {
        data: "String Object data",
        key: "testKey.txt",
        bucket: 'testBucket',
        extension: 'txt',
        acl: 'public-read'
      };
      return s3client.upload(uploadOptions, function(err, url) {
        expect(url).to.exists;
        expect(url).to.equal('https://testBucket.s3.amazonaws.com/testKey.txt');
        return done();
      });
    });
  });
  return describe('#put tests', function() {
    var s3client;
    s3client = null;
    before(function() {
      s3client = new s3BrowserUpload({
        accessKeyId: 'rHiziprP5FLOL5DpLaRc',
        secretAccessKey: 'dGudXJxDvtgZ2oRvzuMY1uWA/tsziUXwkd3tnJBk',
        signatureVersion: "v4",
        region: "eu-central-1"
      });
      return sinon.stub(s3client.s3, 'getSignedUrl', function(typeName, params, cb) {
        return cb(null, 'https://testBucket.s3.amazonaws.com/testKey.txt');
      });
    });
    after(function() {
      return s3client.s3.getSignedUrl.restore();
    });
    return it('should return json with signed and public urls', function(done) {
      var uploadOptions;
      uploadOptions = {
        key: "testKey.txt",
        bucket: 'testBucket',
        extension: 'txt',
        acl: 'public-read'
      };
      return s3client.put(uploadOptions, function(err, urls) {
        expect(urls).to.have.property('signed_url');
        expect(urls).to.have.property('public_url');
        return done();
      });
    });
  });
});

//# sourceMappingURL=data:application/json;base64,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LENBQVksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQXJCLENBQThCLFlBQTlCO1FBQ0EsTUFBQSxDQUFPLElBQVAsQ0FBWSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBckIsQ0FBOEIsWUFBOUI7ZUFDQSxJQUFBLENBQUE7TUFIMEIsQ0FBNUI7SUFQbUQsQ0FBckQ7RUFqQnFCLENBQXZCO0FBMUZrQyxDQUFwQyIsImZpbGUiOiJ0ZXN0L2luZGV4LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIyBzMy1icm93c2VyLWRpcmVjdC11cGxvYWRcbl8gICAgICAgICAgID0gcmVxdWlyZSgnbG9kYXNoJylcbmZzICAgICAgICAgID0gcmVxdWlyZSgnZnMnKVxubW9tZW50ICAgICAgPSByZXF1aXJlKCdtb21lbnQnKVxuXG5jaGFpICAgICAgICA9IHJlcXVpcmUoJ2NoYWknKVxucGF0aCAgICAgICAgPSByZXF1aXJlKCdwYXRoJylcbnNpbm9uICAgICAgID0gcmVxdWlyZSgnc2lub24nKVxuc2lub25DaGFpICAgPSByZXF1aXJlKCdzaW5vbi1jaGFpJylcblxuYXNzZXJ0ICAgID0gY2hhaS5hc3NlcnRcbmV4cGVjdCAgICA9IGNoYWkuZXhwZWN0XG5cbmNoYWkudXNlKHNpbm9uQ2hhaSlcbnMzQnJvd3NlclVwbG9hZCA9IHJlcXVpcmUoJy4uL2xpYicpXG5cblxuIyBURVNUU1xuZGVzY3JpYmUgJ3MzLXVwbG9hZFBvc3RGb3JtIHRlc3RzJywgKCkgLT5cblxuICBkZXNjcmliZSAnI3VwbG9hZFBvc3RGb3JtIHRlc3RzJywgKCkgLT5cblxuICAgIHMzY2xpZW50ID0gbnVsbFxuXG4gICAgYmVmb3JlIC0+XG4gICAgICBzM2NsaWVudCA9IG5ldyBzM0Jyb3dzZXJVcGxvYWRcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICdySGl6aXByUDVGTE9MNURwTGFSYydcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiAnZEd1ZFhKeER2dGdaMm9Sdnp1TVkxdVdBL3RzemlVWHdrZDN0bkpCaydcbiAgICAgICAgc2lnbmF0dXJlVmVyc2lvbjogXCJ2NFwiXG4gICAgICAgIHJlZ2lvbjogXCJldS1jZW50cmFsLTFcIlxuXG4gICAgaXQgJ3Nob3VsZCByZXR1cm4ganNvbiB3aXRoIGFsbCBwYXJhbWV0ZXJzIHJlcXVpcmVkIHRvIGJ1aWxkIGEgZm9ybScsIChkb25lKSAtPlxuICAgICAgdXBsb2FkUG9zdEZvcm1PcHRpb25zID1cbiAgICAgICAga2V5OiBcInRlc3RLZXkuanBnXCJcbiAgICAgICAgYnVja2V0OiAndGVzdEJ1Y2tldCdcbiAgICAgICAgZXhwaXJlczogbW9tZW50KCkuYWRkKDYwLCAnbWludXRlcycpLnRvRGF0ZSgpXG4gICAgICAgIGV4dGVuc2lvbjogJ2pwZydcblxuICAgICAgczNjbGllbnQudXBsb2FkUG9zdEZvcm0gdXBsb2FkUG9zdEZvcm1PcHRpb25zLCAoZXJyLCBwYXJhbXMpIC0+XG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLmtleSdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMuYWNsJ1xuICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy5jb250ZW50LXR5cGUnXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLngtYW16LWFsZ29yaXRobSdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMueC1hbXotY3JlZGVudGlhbCdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMueC1hbXotZGF0ZSdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMucG9saWN5J1xuICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1zaWduYXR1cmUnXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncHVibGljX3VybCdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdmb3JtX3VybCdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8ubm90LmhhdmUuZGVlcC5wcm9wZXJ0eSAnY29uZGl0aW9ucydcblxuICAgICAgICBkb25lKClcblxuICAgIGl0ICdzaG91bGQgcmV0dXJuIGpzb24gd2l0aCBhbGwgcGFyYW1ldGVycyByZXF1aXJlZCB0byBidWlsZCBhIGZvcm0gaWYgY3VzdG9tIGNvbmRpdGlvbk1hdGNoaW5nIHVzZWQnLCAoZG9uZSkgLT5cbiAgICAgIHVwbG9hZFBvc3RGb3JtT3B0aW9ucyA9XG4gICAgICAgIGtleTogXCJ0ZXN0S2V5LmpwZ1wiXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3RCdWNrZXQnXG4gICAgICAgIGV4cGlyZXM6IG1vbWVudCgpLmFkZCg2MCwgJ21pbnV0ZXMnKS50b0RhdGUoKVxuICAgICAgICBleHRlbnNpb246ICdqcGcnXG4gICAgICAgIGNvbmRpdGlvbk1hdGNoaW5nOiBbXG4gICAgICAgICAge1wic3VjY2Vzc19hY3Rpb25fcmVkaXJlY3RcIjogXCJodHRwOi8vZ29vZ2xlLmNvbVwifVxuICAgICAgICBdXG5cbiAgICAgIHMzY2xpZW50LnVwbG9hZFBvc3RGb3JtIHVwbG9hZFBvc3RGb3JtT3B0aW9ucywgKGVyciwgcGFyYW1zKSAtPlxuICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy5rZXknXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLmFjbCdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMuY29udGVudC10eXBlJ1xuICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3BhcmFtcy54LWFtei1hbGdvcml0aG0nXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLngtYW16LWNyZWRlbnRpYWwnXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLngtYW16LWRhdGUnXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAncGFyYW1zLnBvbGljeSdcbiAgICAgICAgZXhwZWN0KHBhcmFtcykudG8uaGF2ZS5kZWVwLnByb3BlcnR5ICdwYXJhbXMueC1hbXotc2lnbmF0dXJlJ1xuICAgICAgICBleHBlY3QocGFyYW1zKS50by5oYXZlLmRlZXAucHJvcGVydHkgJ3B1YmxpY191cmwnXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAnZm9ybV91cmwnXG4gICAgICAgIGV4cGVjdChwYXJhbXMpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSAnY29uZGl0aW9ucydcblxuICAgICAgICBkb25lKClcblxuICBkZXNjcmliZSAnI3VwbG9hZCB0ZXN0cycsICgpIC0+XG5cbiAgICBzM2NsaWVudCA9IG51bGxcblxuICAgIGJlZm9yZSAtPlxuICAgICAgczNjbGllbnQgPSBuZXcgczNCcm93c2VyVXBsb2FkXG4gICAgICAgIGFjY2Vzc0tleUlkOiAnckhpemlwclA1RkxPTDVEcExhUmMnXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogJ2RHdWRYSnhEdnRnWjJvUnZ6dU1ZMXVXQS90c3ppVVh3a2QzdG5KQmsnXG4gICAgICAgIHNpZ25hdHVyZVZlcnNpb246IFwidjRcIlxuICAgICAgICByZWdpb246IFwiZXUtY2VudHJhbC0xXCJcblxuICAgICAgc2lub24uc3R1YiBzM2NsaWVudC5zMywgJ3VwbG9hZCcsIChwYXJhbXMsIGNiKSAtPlxuICAgICAgICBjYigpXG5cbiAgICBhZnRlciAtPlxuICAgICAgczNjbGllbnQuczMudXBsb2FkLnJlc3RvcmUoKVxuXG4gICAgaXQgJ3Nob3VsZCByZXR1cm4gdXJsIG9mIHVwbG9hZGVkIGZpbGUnLCAoZG9uZSkgLT5cbiAgICAgIHVwbG9hZE9wdGlvbnMgPVxuICAgICAgICBkYXRhOiBcIlN0cmluZyBPYmplY3QgZGF0YVwiXG4gICAgICAgIGtleTogXCJ0ZXN0S2V5LnR4dFwiXG4gICAgICAgIGJ1Y2tldDogJ3Rlc3RCdWNrZXQnXG4gICAgICAgIGV4dGVuc2lvbjogJ3R4dCdcbiAgICAgICAgYWNsOiAncHVibGljLXJlYWQnXG5cbiAgICAgIHMzY2xpZW50LnVwbG9hZCB1cGxvYWRPcHRpb25zLCAoZXJyLCB1cmwpIC0+XG4gICAgICAgIGV4cGVjdCh1cmwpLnRvLmV4aXN0c1xuICAgICAgICBleHBlY3QodXJsKS50by5lcXVhbCAnaHR0cHM6Ly90ZXN0QnVja2V0LnMzLmFtYXpvbmF3cy5jb20vdGVzdEtleS50eHQnXG4gICAgICAgIGRvbmUoKVxuXG4gIGRlc2NyaWJlICcjcHV0IHRlc3RzJywgKCkgLT5cblxuICAgIHMzY2xpZW50ID0gbnVsbFxuXG4gICAgYmVmb3JlIC0+XG4gICAgICBzM2NsaWVudCA9IG5ldyBzM0Jyb3dzZXJVcGxvYWRcbiAgICAgICAgYWNjZXNzS2V5SWQ6ICdySGl6aXByUDVGTE9MNURwTGFSYydcbiAgICAgICAgc2VjcmV0QWNjZXNzS2V5OiAnZEd1ZFhKeER2dGdaMm9Sdnp1TVkxdVdBL3RzemlVWHdrZDN0bkpCaydcbiAgICAgICAgc2lnbmF0dXJlVmVyc2lvbjogXCJ2NFwiXG4gICAgICAgIHJlZ2lvbjogXCJldS1jZW50cmFsLTFcIlxuXG4gICAgICBzaW5vbi5zdHViIHMzY2xpZW50LnMzLCAnZ2V0U2lnbmVkVXJsJywgKHR5cGVOYW1lLCBwYXJhbXMsIGNiKSAtPlxuICAgICAgICBjYihudWxsLCAnaHR0cHM6Ly90ZXN0QnVja2V0LnMzLmFtYXpvbmF3cy5jb20vdGVzdEtleS50eHQnKVxuXG4gICAgYWZ0ZXIgLT5cbiAgICAgIHMzY2xpZW50LnMzLmdldFNpZ25lZFVybC5yZXN0b3JlKClcblxuICAgIGl0ICdzaG91bGQgcmV0dXJuIGpzb24gd2l0aCBzaWduZWQgYW5kIHB1YmxpYyB1cmxzJywgKGRvbmUpIC0+XG4gICAgICB1cGxvYWRPcHRpb25zID1cbiAgICAgICAga2V5OiBcInRlc3RLZXkudHh0XCJcbiAgICAgICAgYnVja2V0OiAndGVzdEJ1Y2tldCdcbiAgICAgICAgZXh0ZW5zaW9uOiAndHh0J1xuICAgICAgICBhY2w6ICdwdWJsaWMtcmVhZCdcblxuICAgICAgczNjbGllbnQucHV0IHVwbG9hZE9wdGlvbnMsIChlcnIsIHVybHMpIC0+XG4gICAgICAgIGV4cGVjdCh1cmxzKS50by5oYXZlLnByb3BlcnR5ICdzaWduZWRfdXJsJ1xuICAgICAgICBleHBlY3QodXJscykudG8uaGF2ZS5wcm9wZXJ0eSAncHVibGljX3VybCdcbiAgICAgICAgZG9uZSgpXG5cblxuXG5cbiJdfQ==